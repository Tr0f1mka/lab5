Лабораторная работа №5 "Работа с отладчиком"
Отладка кодовой базы лабораторной работы №4 с помощью средств отладки.

Важные файлы/папки
README.md - отчёт по работе

src - исправленная версия проекта. В этой директории можно найти места, в которых были баги (поиск по слову "Баг").

src_buggy - неисправленная версия проекта

Отчёт
Ошибка 1 — взятие не метода как метод
Место: base_classes.py, класс Goose, метод __add__

Симптом: Попытка взять поле target (класс Player) как метод класса Goose.

Как воспроизвести: Запустить симуляцию с seed=1.

Отладка: Установлен breakpoint на строки methods[component] = getattr(self, component).__func__. В отладчике видно, что программа пытается взять target как метод класса Goose.

Причина: Отсутствует «отсеивание» target при сборе методов слагаемых гусей.

Исправление: Добавлено:

python
if component == "target":
    continue
Проверка: Поведение симуляции соответствует ожидаемому.

Доказательства:

screens/bug1/place_with_exception.png

screens/bug1/locals.png

Ошибка 2 — использование игрока-цели как метод
Место: player_collection.py, класс PlayerCollection, метод honk_update.

Симптом: Отрицательный счёт игроков в конце.

Как воспроизвести: Запустить симуляцию с seed=4 и steps=60.

Отладка: Установлен breakpoint на строке i.balance -= 5. В отладчике видно, что программа пытается взять target как метод класса Goose.

Причина: Отсутствует «отсеивание» target при сборе методов слагаемых гусей.

Исправление: Добавлено:

python
if component == "target":
    continue
Проверка: Поведение симуляции соответствует ожидаемому.

Доказательства:

screens/bug2/place_where_bug_is_visible.png

screens/bug2/locals.png

Ошибка 3 — кража игроком несуществующих монет
Место: players.py, класс LuckPlayer, метод steel_goose.

Симптом: Отрицательный счёт у обворовываемого гуся.

Как воспроизвести: Запустить симуляцию с seed=4.

Отладка: Установлен breakpoint на строке self.balance += s. В отладчике видно, что баланс гуся становится отрицательным.

Причина: Отсутствует проверка наличия воруемой у гуся суммы.

Исправление: Изменено:

python
if s <= goose.balance:
    goose.balance -= s
    self.balance += s
    print(f"Ловкий игрок {self.name} успешно крадёт у гуся {goose.name} {s} монет")
else:
    self.balance += goose.balance
    print(f"Ловкий игрок {self.name} успешно крадёт у гуся {goose.name} {goose.balance} монет")
    goose.balance = 0
Проверка: Поведение симуляции соответствует ожидаемому.

Доказательства:

screens/bug3/place_where_bug_is_visible.png

screens/bug3/locals.png

Ошибка 4 — использование гуся-кредитора как метод
Место: base_place.py, класс Player, метод __call__.

Симптом: Симуляция пытается вызвать гуся-кредитора во время вызова метода игрока.

Как воспроизвести: Запустить симуляцию с seed=14 и steps=50.

Отладка: Установлен breakpoint на строке method(players.random()). В отладчике видно, что программа пытается выполнить creditor как метод класса Player.

Причина: Отсутствует «отсеивание» creditor при сборе методов слагаемых гусей.

Исправление: Добавлено:

python
if component == "creditor":
    continue
Проверка: Поведение симуляции соответствует ожидаемому.

Доказательства:

screens/bug4/place_where_bug_is_visible.png

screens/bug4/locals.png

Ошибка 5 — удаление игрока из пустой коллекции
Место: casino.py, класс Casino, метод iteration.

Симптом: Повторные срабатывания метода repress стаи, в которой есть BouncerGoose, вызывает исключение взятия игрока из пустой коллекции.

Как воспроизвести: Запустить симуляцию с seed=2 и steps=40.

Отладка: Установлен breakpoint на строке result = goose(self.players, self.geese). В отладчике видно, что программа передаёт пустую коллекцию игроков как аргумент метода __call__ экземпляра класса Goose.

Причина: Отсутствует проверка пустоты коллекции игроков в цикле методов гусей.

Исправление: Добавлено:

python
if not self.players:
    self.goose_balance.update_balance(self.geese)
    self.player_balance.update_balance(self.players)
    return
Проверка: Поведение симуляции соответствует ожидаемому.

Доказательства:

screens/bug5/place_where_bug_is_visible.png

screens/bug5/locals.png